{% extends "base.html" %}
{% block content %}
<div class="card glass p-4">
  <div class="flex items-center justify-between">
    <h2 class="text-lg font-semibold">Reports</h2>
    <div class="text-sm text-slate-600">Live data</div>
  </div>
</div>

<div class="mt-4 grid gap-4 md:grid-cols-3">
  <div class="bg-white card p-4">
    <h3 class="font-semibold mb-2">Credits by Vendor</h3>
    <canvas id="chartCreditsByVendor"></canvas>
  </div>
  <div class="bg-white card p-4">
    <h3 class="font-semibold mb-2">Items by Month</h3>
    <canvas id="chartItemsByMonth"></canvas>
  </div>
  <div class="bg-white card p-4">
    <h3 class="font-semibold mb-2">Avg Days to Credit (by Vendor)</h3>
    <canvas id="chartAvgDaysToCredit"></canvas>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
async function get(url){ const r = await fetch(url); return await r.json(); }
(async () => {
  const credits = await get('{{ url_for("credits_by_vendor") }}');
  const items = await get('{{ url_for("items_by_month") }}');
  const days = await get('{{ url_for("avg_days_to_credit_by_vendor") }}');

  new Chart(document.getElementById('chartCreditsByVendor'), {
    type:'bar', data:{labels:credits.labels, datasets:[
      {label:'Used', data:credits.used},
      {label:'Remaining', data:credits.remaining}
    ]}, options:{responsive:true, plugins:{legend:{position:'bottom'}}}
  });
  new Chart(document.getElementById('chartItemsByMonth'), {
    type:'line', data:{labels:items.labels, datasets:[{label:'Items', data:items.counts}]},
    options:{responsive:true, plugins:{legend:{display:false}}}
  });
  new Chart(document.getElementById('chartAvgDaysToCredit'), {
    type:'bar', data:{labels:days.labels, datasets:[{label:'Avg days', data:days.avg_days}]},
    options:{responsive:true, plugins:{legend:{display:false}}}
  });
})();
</script>
{% endblock %}
